jQuery(document).ready(function(e){var t=["toplevel_page_cfm-hosting-publish-episode","admin_page_cfm-hosting-publish-episode","captivate-sync_page_cfm-hosting-publish-episode"];const n=Quill.import("blots/block/embed");class i extends n{static create(e){const t=super.create(e);return t.setAttribute("contenteditable","true"),t.innerHTML=this.transformValue(e),t}static transformValue(e){let t=e.split("\n");return(t=t.map(e=>e.replace(/^[\s]+/,"").replace(/[\s]+$/,""))).join("")}static value(e){return e.innerHTML}}i.blotName="SnippetEmbed",i.className="cfm-ql-snippet",i.tagName="div",Quill.register(i,!0);var s="";if(e("#cfm-field-wpeditor").length){if(s=new Quill("#cfm-field-wpeditor",{modules:{toolbar:"#quilljs-toolbar"},placeholder:"Insert text here ...",theme:"snow"}),document.querySelector("#cfm-form-publish-episode").onsubmit=function(){var t=e("#cfm-field-wpeditor").find(".ql-editor").html();document.querySelector("textarea[name=post_content]").value=t},s.on("text-change",function(n,i){var o=e("#cfm-field-wpeditor").find(".ql-editor").html();""!=o&&"<p><br></p>"!=o&&(e("#cfm-field-wpeditor").removeClass("cfm-field-error"),e(".cfm-show-description .ql-toolbar.ql-snow").removeClass("cfm-field-error"),e("#shownotes-error").remove()),-1!==e.inArray(cfmsync.CFMH_CURRENT_SCREEN,t)&&(localStorage.setItem(cfmsync.CFMH_SHOWID+"_shownotes_local",JSON.stringify(s.getContents())),localStorage.setItem(cfmsync.CFMH_SHOWID+"_shownotes_local_html",o))}),e("span#cfm-snippets .ql-picker-options").html(""),-1!==e.inArray(cfmsync.CFMH_CURRENT_SCREEN,t)){const e=localStorage.getItem(cfmsync.CFMH_SHOWID+"_shownotes_local");s.setContents(JSON.parse(e))}e(document).on("click","#cfm-snippets .ql-picker-item",function(t){var n,i,o=e(this).data("value"),p=s.selection.savedRange.index;if(""!=o||"undefined"!=o){s.insertEmbed(p,"SnippetEmbed",(n=o,i=document.createElement("div"),new Quill(i).setContents(n),i.getElementsByClassName("ql-editor")[0].innerHTML)),e(".cfm-ql-snippet").contents().unwrap()}e("span#cfm-snippets").removeClass("ql-expanded")})}e(document).on("click","#cfm-manage-snippets",function(e){e.preventDefault()}),e(document).on("click","span#cfm-snippets",function(t){e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"ql-load-snippets",show_id:cfmsync.CFMH_SHOWID,_nonce:cfmsync.ajaxnonce},dataType:"json",beforeSend:function(t){e("span#cfm-snippets .ql-picker-options").html('<div id="snippets-preloader" class="mt-2 mb-2"><div class="d-flex justify-content-center"><div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div></div></div>')},success:function(t){"error"==t.output?alert("Something went wrong. Please contact support."):(e("select#cfm-snippets").html(t.ql_snippets),e("span#cfm-snippets .ql-picker-options").html(t.ql_snippets2))}})});var o="";if(e("#cfm-snippet-ql-editor").length){(o=new Quill("#cfm-snippet-ql-editor",{modules:{toolbar:[["bold","italic","underline","strike"],["blockquote"],[{size:["small",!1,"large","huge"]}],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link"],["clean"]]},placeholder:"Insert text here ...",theme:"snow"})).on("text-change",function(t,n){var i=e("#cfm-snippet-ql-editor").find(".ql-editor").html();e("#snippet_content").html(html),""!=i&&"<p><br></p>"!=i&&(e("#cfm-snippet-ql-editor").removeClass("cfm-field-error"),e(".cfm-snippet-create .ql-toolbar.ql-snow").removeClass("cfm-field-error"),e("#snippet_content-error").remove())})}e.fn.loadSnippets=function(){e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"manage-snippets",show_id:cfmsync.CFMH_SHOWID,_nonce:cfmsync.ajaxnonce},beforeSend:function(t){e("#cfm-snippet-list").html('<div id="snippets-preloader"><div class="d-flex justify-content-center"><div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div></div></div>')},success:function(t){e("#cfm-snippet-list").html(t)}})},e("#cfm-snippets-modal").on("show.bs.modal",function(t){e(document).loadSnippets()}),e.fn.clearSnippetFields=function(){e("#snippet_id").val(""),e("#snippet_title").val(""),e("#cfm-snippet-ql-editor .ql-editor").html(""),e("#snippet_content").html(""),e("#cfm-snippet-save").prop("disabled",!1),e("#cfm-snippet-save").html("Save"),e("#snippet_title-error").remove(),e("#snippet_content-error").remove(),e("input[name=snippet_title]").removeClass("cfm-field-error"),e("#cfm-snippet-ql-editor").removeClass("cfm-field-error"),e(".cfm-snippet-create .ql-toolbar.ql-snow").removeClass("cfm-field-error")},e.fn.showSnippetCreate=function(){e("#cfm-snippet-list").hide(),e("#cfm-snippet-create").fadeIn(),e("#cfm-modal-footer-edit").fadeIn(),e("#cfm-modal-footer-default").hide()},e.fn.showSnippetList=function(){e("#cfm-snippet-list").fadeIn(),e("#cfm-snippet-create").hide(),e("#cfm-modal-footer-edit").hide(),e("#cfm-modal-footer-default").fadeIn()},e(document).on("keyup","input[name=snippet_title]",function(t){e("#snippet_title-error").remove(),e("input[name=snippet_title]").removeClass("cfm-field-error")}),e(document).on("click",".cfm-snippet-edit",function(t){var n=e(this).data("id"),i="",s="";""!==n&&(n=e(this).data("id"),i=e(this).attr("data-title"),s=e(this).attr("data-content")),e("#snippet_id").val(n),e("#snippet_title").val(i),""==s?(e("#snippet_content").html(""),e("#cfm-snippet-ql-editor .ql-editor").html("")):o.setContents(JSON.parse(s)),e(document).showSnippetCreate(),t.preventDefault()}),e(document).on("click","#cfm-snippet-cancel",function(t){e(document).clearSnippetFields(),e(document).showSnippetList(),t.preventDefault()}),e(document).on("click","#cfm-snippet-save",function(t){t.preventDefault();var n,i=e("input[name=snippet_id]").val(),s=e("input[name=snippet_title]").val(),p=JSON.stringify(o.getContents()),r=e("textarea[name=snippet_content]").html(),l=0;""==s&&(e("input[name=snippet_title]").addClass("cfm-field-error"),e("#snippet_title-error").length||e('<div id="snippet_title-error" class="cfm-field-error-text">You need a title for your snippet.</div>').insertAfter("input[name=snippet_title]"),l+=1),1===((n=o).getContents().ops||[]).length&&0===n.getText().trim().length&&(e("#cfm-snippet-ql-editor").addClass("cfm-field-error"),e(".cfm-snippet-create .ql-toolbar.ql-snow").addClass("cfm-field-error"),e("#snippet_content-error").length||e('<div id="snippet_content-error" class="cfm-field-error-text">Please enter a reusable snippet.</div>').insertAfter("#cfm-snippet-ql-editor"),l+=1),0==l&&e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"edit-snippet",show_id:cfmsync.CFMH_SHOWID,snippet_id:i,snippet_title:s,snippet_content:p,snippet_textarea:r,_nonce:cfmsync.ajaxnonce},beforeSend:function(t){e("#cfm-snippet-save").prop("disabled",!0),e("#cfm-snippet-save").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...')},success:function(t){e("#cfm-snippet-save").prop("disabled",!1),e("#cfm-snippet-save").html("Save"),"error"==t?alert("Something went wrong. Please contact support."):"req_fields"==t?alert("Please fill in the required fields."):"max_snippets_reached"==t?alert("You've reached the maximum snippets allowed."):(e(document).loadSnippets(),e(document).clearSnippetFields(),e(document).showSnippetList())}}),t.preventDefault()}),e(document).on("click","#cfm-snippet-list .cfm-snippet-delete",function(t){t.preventDefault();var n=e(this).data("id"),i=e(this).data("nonce"),s=e("#cfm-snippet-list #snippet-"+n);confirm("Are you sure you want to delete this snippet? This snippet will be deleted on Captivate too.")&&e.ajax({url:cfmsync.ajaxurl,type:"post",data:{action:"delete-snippet",snippet_id:n,show_id:cfmsync.CFMH_SHOWID,_nonce:i},beforeSend:function(e){s.css({"background-color":"#ff3333"},500)},success:function(t){"error"==t?alert("Something went wrong. Please contact support."):s.fadeOut(500,function(){s.remove(),e(document).loadSnippets()})}}),t.preventDefault()}),e("#cfm-snippets-modal").on("hidden.bs.modal",function(){e(document).clearSnippetFields(),e(document).showSnippetList()})});